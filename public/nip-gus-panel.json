{
  "version": "1.0",
  "components": [
    {
      "type": "header",
      "text": "üèõÔ∏è NIP Field z GUS"
    },
    {
      "type": "text",
      "text": "Automatyczne pobieranie danych firmy z rejestru GUS na podstawie numeru NIP",
      "style": "muted"
    },
    {
      "type": "spacer",
      "size": "small"
    },
    {
      "type": "input",
      "id": "nip_input",
      "label": "Numer NIP:",
      "placeholder": "XXX-XXX-XX-XX",
      "validation": {
        "required": true,
        "pattern": "^[0-9]{10}$|^[0-9]{3}-[0-9]{3}-[0-9]{2}-[0-9]{2}$",
        "message": "Wprowad≈∫ prawid≈Çowy numer NIP (10 cyfr)"
      }
    },
    {
      "type": "button",
      "id": "fetch_button",
      "text": "üìä Pobierz dane z GUS",
      "style": "primary",
      "action": {
        "type": "http_request",
        "method": "POST",
        "url": "https://pipedrive-oauth-server.devikit.pl/api/json-panel/fetch-gus-data",
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "nip": "{{components.nip_input.value}}",
          "organization_id": "{{context.organization.id}}",
          "user_id": "{{context.user.id}}",
          "company_id": "{{context.company.id}}"
        }
      },
      "loading_text": "Pobieranie danych z GUS...",
      "disabled_when": "{{!components.nip_input.value}}"
    },
    {
      "type": "spacer",
      "size": "medium"
    },
    {
      "type": "status",
      "id": "status_indicator",
      "text": "Wprowad≈∫ numer NIP i kliknij 'Pobierz dane z GUS'",
      "status": "neutral"
    },
    {
      "type": "spacer",
      "size": "small"
    },
    {
      "type": "text",
      "text": "üí° Wskaz√≥wka: Po pobraniu danych nazwa i adres organizacji zostanƒÖ automatycznie zaktualizowane",
      "style": "muted",
      "size": "small"
    }
  ],
  "actions": [
    {
      "id": "fetch_gus_data",
      "on_success": [
        {
          "type": "update_component",
          "component_id": "status_indicator",
          "properties": {
            "text": "‚úÖ Dane zosta≈Çy pobrane z GUS i zaktualizowane",
            "status": "success"
          }
        },
        {
          "type": "clear_component",
          "component_id": "nip_input"
        },
        {
          "type": "refresh_context"
        }
      ],
      "on_error": [
        {
          "type": "update_component",
          "component_id": "status_indicator", 
          "properties": {
            "text": "‚ùå B≈ÇƒÖd podczas pobierania danych z GUS",
            "status": "error"
          }
        }
      ]
    }
  ],
  "context": {
    "organization": true,
    "user": true,
    "company": true
  }
}
